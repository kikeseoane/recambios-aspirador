{{ define "main" }}
  {{ $db := site.Data.aspiradores }}
  {{ $brands := $db.brands }}
  {{ $brandKey := .Params.brandKey }}

  {{ if $brandKey }}
    {{ $brand := index $brands $brandKey }}

    {{ if $brand }}
      <section class="hero hero--bg hero--compact">
        <div class="hero__inner">
          <div class="hero__kicker">Marca</div>
          <h1>{{ $brand.name }}</h1>
          <p class="muted hero__copy">Elige tu modelo para ver recambios compatibles, checks y fallos comunes.</p>

          <div class="hero__links">
            <a class="btn btn--ghost" href="{{ "/marcas/" | relURL }}">← Volver a marcas</a>
            <a class="btn btn--link" href="{{ "/modelos/" | relURL }}">Ver todos los modelos →</a>
          </div>
        </div>
      </section>

      {{ $models := $brand.models }}
      {{ if $models }}
        <div class="grid cards">
          {{ range $m := $models }}
            {{ $mslug := (or $m.slug $m.canonical_slug) | urlize }}

            {{ $brandName := $brand.name }}
            {{ $modelName := $m.model }}
            {{ $bnLower := lower $brandName }}
            {{ $mnLower := lower $modelName }}
            {{ $title := "" }}
            {{ if and $modelName (hasPrefix $mnLower $bnLower) }}
              {{ $title = $modelName }}
            {{ else }}
              {{ $title = printf "%s %s" $brandName $modelName }}
            {{ end }}

            <a class="card card--with-icon" href="{{ (printf "/modelos/%s/" $mslug) | relURL }}">
              {{ partial "card_icon.html" (dict "kind" "model") }}

              <div class="card-body">
                <h3>{{ $title }}</h3>
                <div class="badges">
                  {{ with $m.series }}<span class="badge">Serie {{ . }}</span>{{ end }}
                  {{ with $m.year_range }}<span class="badge">{{ . }}</span>{{ end }}
                </div>
                <p class="muted" style="margin-top:10px;">Ver recambios y guía rápida de compatibilidad.</p>
              </div>
            </a>
          {{ end }}
        </div>
      {{ else }}
        <div class="card">
          <h3>Modelos en preparación</h3>
          <p class="muted">Estamos ampliando esta marca. Vuelve en breve para ver modelos y recambios.</p>
        </div>
      {{ end }}

    {{ else }}
      {{ .Scratch.Set "noindex" true }}
      <h1>Marca no disponible</h1>
      <p class="muted">No encontramos esa marca en el catálogo actual.</p>
      <a class="chip" href="{{ "/marcas/" | relURL }}">Volver a marcas</a>
    {{ end }}

  {{ else }}
    <section class="hero hero--bg hero--compact">
      <div class="hero__inner">
        <div class="hero__kicker">Catálogo</div>
        <h1>{{ .Title }}</h1>
        <p class="muted hero__copy">Elige una marca para ver sus modelos y recambios compatibles.</p>

        <div class="hero__links">
          <a class="btn btn--ghost" href="{{ "/modelos/" | relURL }}">Ver modelos</a>
          <a class="btn btn--link" href="{{ "/guias/compra/" | relURL }}">Cómo elegir recambio →</a>
        </div>
      </div>
    </section>

    <div class="grid cards">
      {{ range $k, $b := $brands }}
        {{ $slug := $k | urlize }}
        <a class="card card--with-icon" href="{{ (printf "/marcas/%s/" $slug) | relURL }}">
          {{ partial "card_icon.html" (dict "kind" "brand") }}

          <div class="card-body">
            <h3>{{ $b.name }}</h3>
            <p class="muted">Ver modelos, fallos comunes y recambios compatibles.</p>
            <div class="badges">
              <span class="badge hot">{{ len $b.models }} modelos</span>
              {{ with $b.country_hint }}<span class="badge">{{ . }}</span>{{ end }}
            </div>
          </div>
        </a>
      {{ end }}
    </div>
  {{ end }}
{{ end }}
