{{ define "main" }}
  {{ $db := site.Data.aspiradores }}
  {{ $brandKey := .Params.brandKey }}
  {{ $modelSlug := .Params.modelSlug | urlize }}

  <div class="breadcrumbs">
    <a href="{{ "/" | relURL }}">Inicio</a><span class="sep">›</span>
    <a href="{{ "/marcas/" | relURL }}">Marcas</a><span class="sep">›</span>
    <a href="{{ (printf "/marcas/%s/" ($brandKey|urlize)) | relURL }}">{{ $brandKey }}</a><span class="sep">›</span>
    <a href="{{ (printf "/modelos/%s/" $modelSlug) | relURL }}">Modelo</a><span class="sep">›</span>
    <span>Problemas</span>
  </div>

  <h1>{{ .Title }}</h1>
  <p class="muted">Diagnósticos rápidos: síntomas → checks → recambio recomendado.</p>

  {{/* Para pintar cards, reutiliza el YAML del modelo */}}
  {{ $brand := index $db.brands $brandKey }}
  {{ $model := dict }}
  {{ if $brand }}
    {{ range $m := ($brand.models | default slice) }}
      {{ if eq ((or (index $m "slug") (index $m "canonical_slug") (index $m "id")) | urlize) $modelSlug }}
        {{ $model = $m }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ $probs := index $model "problemas" }}
  {{ if and $probs (reflect.IsSlice $probs) (gt (len $probs) 0) }}
    <div class="grid cards">
      {{ range $p := $probs }}
        {{ $pkey := (index $p "key") | urlize }}
        {{ $ptitle := (index $p "title") | default $pkey }}
        <a class="card" href="{{ (printf "/modelos/%s/problemas/%s/" $modelSlug $pkey) | relURL }}">
          <h3>{{ $ptitle }}</h3>
          {{ with (index $p "intent") }}<span class="badge blue">{{ . }}</span>{{ end }}
          {{ with (index $p "symptoms") }}
            {{ if reflect.IsSlice . }}<p class="muted" style="margin-top:8px;">Síntoma típico: {{ index . 0 }}</p>{{ end }}
          {{ end }}
        </a>
      {{ end }}
    </div>
  {{ else }}
    <div class="card">
      <h3>En preparación</h3>
      <p class="muted">Aún no hay problemas publicados para este modelo.</p>
    </div>
  {{ end }}
{{ end }}
