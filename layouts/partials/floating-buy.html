{{/* Barra CTA flotante SOLO para páginas de recambio individuales */}}
{{ if and (eq .Section "recambios") (not .IsSection) (not .IsHome) }}
  <a id="floating-buy" class="floating-buy" href="#" target="_blank" rel="sponsored nofollow noopener" style="display:none;">
    Ver oferta
  </a>

  <script>
  (function(){
    function isMobile(){ return window.matchMedia && window.matchMedia("(max-width: 768px)").matches; }
    if(!isMobile()) return;

    // 1) prioriza el “principal”
    var primary = document.querySelector(".aff--primary .aff__btn");
    // 2) fallback: primer afiliado normal
    var first   = primary || document.querySelector(".aff .aff__btn");
    if(!first) return;

    var bar = document.getElementById("floating-buy");
    if(!bar) return;

    bar.href = first.getAttribute("href") || "#";

    // Texto: usa el del botón principal, pero recortado
    var t = (first.textContent || "Ver oferta").trim();
    // Opcional: acorta si es muy largo
    if(t.length > 48) t = t.slice(0, 45) + "…";
    bar.textContent = t;

    bar.style.display = "block";
  })();
  </script>
{{ end }}
