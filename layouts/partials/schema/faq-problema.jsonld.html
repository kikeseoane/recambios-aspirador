{{ if eq (.Params.layout | default "") "problema" }}
  {{ $db := site.Data.aspiradores }}
  {{ $bk := .Params.brandKey }}
  {{ $ms := .Params.modelSlug | urlize }}
  {{ $pk := .Params.problemKey | urlize }}

  {{ $brand := index $db.brands $bk }}
  {{ $model := dict }}
  {{ if $brand }}
    {{ range $m := ($brand.models | default slice) }}
      {{ if eq ((or (index $m "slug") (index $m "canonical_slug") (index $m "id")) | urlize) $ms }}
        {{ $model = $m }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ $prob := dict }}
  {{ $probs := index $model "problemas" }}
  {{ if and $probs (reflect.IsSlice $probs) }}
    {{ range $p := $probs }}
      {{ if eq ((index $p "key") | urlize) $pk }}
        {{ $prob = $p }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ if (len $prob) }}
    {{ $sym := index $prob "symptoms" }}
    {{ $causes := index $prob "causes" }}
    {{ $checks := index $prob "checks" }}
    {{ $fix := index $prob "fix_hint" }}

    <script type="application/ld+json">
    {
      "@context":"https://schema.org",
      "@type":"FAQPage",
      "mainEntity":[
        {
          "@type":"Question",
          "name":{{ (printf "¿Cuáles son los síntomas típicos de “%s”?" .Title) | jsonify }},
          "acceptedAnswer":{"@type":"Answer","text":{{ (delimit ($sym | default slice) "<br>") | jsonify }}}
        },
        {
          "@type":"Question",
          "name":"¿Causas más probables?",
          "acceptedAnswer":{"@type":"Answer","text":{{ (delimit ($causes | default slice) "<br>") | jsonify }}}
        },
        {
          "@type":"Question",
          "name":"¿Cómo comprobarlo paso a paso?",
          "acceptedAnswer":{"@type":"Answer","text":{{ (delimit ($checks | default slice) "<br>") | jsonify }}}
        }{{ if $fix }},
        {
          "@type":"Question",
          "name":"¿Qué hacer si se confirma?",
          "acceptedAnswer":{"@type":"Answer","text":{{ $fix | jsonify }}}
        }{{ end }}
      ]
    }
    </script>
  {{ end }}
{{ end }}
